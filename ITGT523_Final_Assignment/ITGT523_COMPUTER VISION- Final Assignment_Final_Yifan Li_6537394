{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "68358f35",
   "metadata": {},
   "source": [
    "# ITGT523_COMPUTER VISION_Final Assignment_Snake Game"
   ]
  },
  {
   "cell_type": "raw",
   "id": "c9fc5ca9",
   "metadata": {},
   "source": [
    "Group Members:\n",
    "\n",
    "ğŸ¤“ Yifan Li_6537394 \n",
    "ğŸ¤“ Xiaoke Yu_6538170"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b1b3c103",
   "metadata": {},
   "source": [
    "# æƒ³æ³• Idea"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "83066ae7",
   "metadata": {},
   "source": [
    "![Image name](https://raw.githubusercontent.com/SPDUK/snake-elixir/master/snake.gif)"
   ]
  },
  {
   "cell_type": "raw",
   "id": "8db3ce61",
   "metadata": {},
   "source": [
    "                                               ğŸ"
   ]
  },
  {
   "cell_type": "raw",
   "id": "69f1a98c",
   "metadata": {},
   "source": [
    "ğŸ“‹ Proposalï¼š\n",
    "\n",
    "1, Combine Hand(Fingertips) Detection and Snake Game to make a simple computer vision game.\n",
    "2, Use finger to control the movement of the snake.\n",
    "3, Play this game with computer's camera.\n",
    "4, Use CVZone and MediaPipe to complete this project."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4653211e",
   "metadata": {},
   "source": [
    "# æ¸¸æˆæœºåˆ¶ Game Mechanics"
   ]
  },
  {
   "cell_type": "raw",
   "id": "4ebf6183",
   "metadata": {},
   "source": [
    "ğŸ“‹ç”¨æ‰‹æŒ‡æ£€æµ‹çš„æ–¹å¼æ§åˆ¶è›‡çš„ç§»åŠ¨æ–¹å‘ï¼Œå»å¯»æ‰¾å¯ä»¥åƒçš„ä¸œè¥¿(äº”è§’æ˜Ÿ)ï¼Œå½“ä½ åƒæ‰äº”è§’æ˜Ÿåå®ƒå°±ä¼šéšæœºåœ¨æ‘„åƒå¤´å±å¹•å‰ç”Ÿæˆä¸€ä¸ªæ–°çš„ï¼Œç©å®¶æ¯åƒä¸€ä¸ªäº”è§’æ˜Ÿè·å¾—1åˆ†ï¼Œåƒå¾—è¶Šå¤šè›‡çš„èº«ä½“å°±è¶Šé•¿ï¼Œæ¸¸æˆéš¾åº¦éšè›‡çš„èº«ä½“å˜é•¿è€ŒåŠ å¤§ï¼Œç©å®¶æ“ä½œçš„è›‡ä¸èƒ½å’¬åˆ°è‡ªå·±çš„èº«ä½“å’Œå°¾å·´ï¼Œå¦åˆ™æ¸¸æˆç»“æŸã€‚\n",
    "\n",
    "ğŸ“‹Use hand tip detection method to control the moving direction of the snake, looking for something(Star) to eat, Every time you eat a star, it will be randomly generated on the screen of the webcam, player can get 1 score for each bite, and the snake's body will become longer and longer as you eat more, the difficulty of the game will become more difficult as the body of the snake grows longer, the snake operated by the player cannot bite its own body and tail, otherwise the game is over."
   ]
  },
  {
   "cell_type": "raw",
   "id": "b81cbe60",
   "metadata": {},
   "source": [
    "ğŸ‘‡Items that snakes eat (stars)ğŸ‘‡    Each +1 score ğŸ’¬"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7f9ed969",
   "metadata": {},
   "source": [
    "![Image name](https://i.328888.xyz/2023/03/15/JiKuo.png)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2cc15952",
   "metadata": {},
   "source": [
    "# 0 ä¸‹è½½ç»„ä»¶ Install components"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "5463cd5a",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: cvzone in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (1.5.6)\n",
      "Requirement already satisfied: numpy in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from cvzone) (1.19.5)\n",
      "Requirement already satisfied: opencv-python in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from cvzone) (4.6.0.66)\n",
      "Note: you may need to restart the kernel to use updated packages.\n"
     ]
    }
   ],
   "source": [
    "pip install cvzone"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "bd3a55ea",
   "metadata": {
    "scrolled": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: OpenCV-python in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (4.6.0.66)\n",
      "Requirement already satisfied: numpy>=1.14.5 in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from OpenCV-python) (1.19.5)\n",
      "Note: you may need to restart the kernel to use updated packages.\n"
     ]
    }
   ],
   "source": [
    "pip install OpenCV-python"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "b3b0e984",
   "metadata": {
    "scrolled": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: mediapipe in c:\\users\\78089\\appdata\\roaming\\python\\python39\\site-packages (0.9.1.0)\n",
      "Requirement already satisfied: attrs>=19.1.0 in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from mediapipe) (22.1.0)\n",
      "Requirement already satisfied: numpy in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from mediapipe) (1.19.5)\n",
      "Requirement already satisfied: absl-py in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from mediapipe) (0.15.0)\n",
      "Requirement already satisfied: protobuf<4,>=3.11 in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from mediapipe) (3.19.6)\n",
      "Requirement already satisfied: opencv-contrib-python in c:\\users\\78089\\appdata\\roaming\\python\\python39\\site-packages (from mediapipe) (4.7.0.68)\n",
      "Requirement already satisfied: flatbuffers>=2.0 in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from mediapipe) (23.1.21)\n",
      "Requirement already satisfied: matplotlib in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from mediapipe) (3.6.2)\n",
      "Requirement already satisfied: six in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from absl-py->mediapipe) (1.15.0)\n",
      "Requirement already satisfied: kiwisolver>=1.0.1 in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from matplotlib->mediapipe) (1.4.4)\n",
      "Requirement already satisfied: python-dateutil>=2.7 in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from matplotlib->mediapipe) (2.8.2)\n",
      "Requirement already satisfied: packaging>=20.0 in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from matplotlib->mediapipe) (22.0)\n",
      "Requirement already satisfied: fonttools>=4.22.0 in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from matplotlib->mediapipe) (4.38.0)\n",
      "Requirement already satisfied: pillow>=6.2.0 in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from matplotlib->mediapipe) (9.3.0)\n",
      "Requirement already satisfied: pyparsing>=2.2.1 in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from matplotlib->mediapipe) (3.0.9)\n",
      "Requirement already satisfied: cycler>=0.10 in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from matplotlib->mediapipe) (0.11.0)\n",
      "Requirement already satisfied: contourpy>=1.0.1 in c:\\users\\78089\\anaconda3\\envs\\python3\\lib\\site-packages (from matplotlib->mediapipe) (1.0.6)\n",
      "Note: you may need to restart the kernel to use updated packages.\n"
     ]
    }
   ],
   "source": [
    "pip install mediapipe --user"
   ]
  },
  {
   "cell_type": "raw",
   "id": "98572c1d",
   "metadata": {},
   "source": [
    "ğŸ“‹ Please note that \"pip install mediapipe\" may not be able to run directly in anaconda3, just add \"-user\" after it."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9883fac5",
   "metadata": {},
   "source": [
    "# 1 è´ªåƒè›‡æ¸¸æˆ Snake Game"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "27aaf2ab",
   "metadata": {},
   "outputs": [],
   "source": [
    "import math\n",
    "import random\n",
    "import cvzone\n",
    "import cv2\n",
    "import numpy as np\n",
    "from cvzone.HandTrackingModule import HandDetector\n",
    "\n",
    "#æˆ‘ä»¬éœ€è¦ä½¿ç”¨cvzoneå’ŒMediaPipeåœ¨è¿™ä¸ªé¡¹ç›®ä¸­ \n",
    "#in this project we need use cvzone and MediaPipe\n",
    "\n",
    "#åœ¨OpenCVä¸­HandDetectorçš„åŠŸèƒ½æ˜¯è§†é¢‘æˆ–è€…å›¾åƒä¸­å¯¹äºæ‰‹éƒ¨æ‰‹æŒ‡ä»¥åŠå…³èŠ‚å…³é”®ç‚¹è¿›è¡Œæ£€æµ‹\n",
    "#HandDetector in OpenCVï¼š Hand Keypoint detection is the process of finding the joints on the fingers as well as the finger-tips in a given image"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9d15e46b",
   "metadata": {},
   "source": [
    "ğŸ‘‡å¯¹äºMidiapipeçš„åŠŸèƒ½å’Œå­¦ä¹ \n",
    "\n",
    "For MediaPipe:       https://google.github.io/mediapipe/solutions/hands.html"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f87a8e0b",
   "metadata": {},
   "source": [
    "ğŸ‘‡å¯¹äºcvzoneçš„åŠŸèƒ½å’Œå­¦ä¹ \n",
    "\n",
    "For cvzone: \n",
    "Official website:     https://www.computervision.zone/\n",
    "Github:            https://github.com/cvzone "
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2cfc0124",
   "metadata": {},
   "source": [
    "# 1.1 æ‰‹éƒ¨è¯†åˆ« Hand Recognition"
   ]
  },
  {
   "cell_type": "raw",
   "id": "19e2de50",
   "metadata": {},
   "source": [
    "åˆ©ç”¨Markdownå¼•ç”¨å›¾ç‰‡\n",
    "\n",
    "æœ¬åœ°å›¾ç‰‡:\n",
    "![image.png](attachment:image.png) \n",
    "![å›¾ç‰‡åŠ è½½å¤±è´¥åæ˜¾ç¤ºçš„æ–‡å­—](æœ¬åœ°å›¾ç‰‡åœ°å€)\n",
    "\n",
    "ç½‘ç»œå›¾ç‰‡ï¼š\n",
    "![Image name](https://h5.sinaimg.cn/upload/1005/526/2020/02/08/logo_20200208.png)\n",
    "![å›¾ç‰‡åç§°](å›¾ç‰‡åœ°å€)\n",
    "\n",
    "ğŸ‘‡ä½¿ç”¨Markdownåˆ›å»ºçš„å›¾ç‰‡ \n",
    "For this project we use point8\n",
    "Image linkï¼š         https://miro.medium.com/max/1400/1*fMBLvkdLbg0MEfv7KbJZjQ.png"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5f04d22a",
   "metadata": {},
   "source": [
    "![Image name](https://miro.medium.com/max/1400/1*fMBLvkdLbg0MEfv7KbJZjQ.png)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b715b471",
   "metadata": {},
   "source": [
    "                                                    ğŸ‘‡Hand Landmarks for this projectğŸ‘‡"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4991b065",
   "metadata": {},
   "source": [
    "![Image name](https://i.328888.xyz/2023/03/15/JiY9z.png)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c508c23f",
   "metadata": {},
   "source": [
    "# 1.2 åˆ©ç”¨æ‰‹æŒ‡ç§»åŠ¨å®ç°è´ªåƒè›‡æ¸¸æˆ Snake Game Realized By Finger Movement"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "240f0da2",
   "metadata": {},
   "source": [
    "![Image name](https://i.328888.xyz/2023/03/15/Ji1kb.png)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1f654436",
   "metadata": {},
   "source": [
    "![Image name](https://i.328888.xyz/2023/03/15/JiPeV.png)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "96f533c7",
   "metadata": {},
   "source": [
    "# 1.3 ä½¿ç”¨è®¡ç®—æœºè§†è§‰çš„è´ªåƒè›‡æ¸¸æˆ Snake Game Using Computer Vision"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "3344d181",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "1\n",
      "2\n",
      "3\n",
      "4\n",
      "5\n",
      "6\n",
      "7\n",
      "8\n",
      "9\n",
      "10\n",
      "11\n",
      "12\n",
      "13\n",
      "14\n",
      "15\n",
      "16\n",
      "17\n",
      "18\n",
      "19\n",
      "20\n",
      "21\n",
      "22\n",
      "23\n",
      "24\n",
      "25\n",
      "Yummy\n"
     ]
    }
   ],
   "source": [
    "cap = cv2.VideoCapture(0) \n",
    "# åˆ›å»ºè§†é¢‘å¯¹è±¡ï¼Œç¬”è®°æœ¬æ‘„åƒå¤´å¿…é¡»ç¼–å·0ï¼Œå¤–æ¥ç”¨ç¼–å·2\n",
    "# To create a video object, the laptop camera must be numbered 0ï¼Œexternal camera 2.\n",
    "\n",
    "# æ³¨æ„åœ¨è¿™ä¸ªé¡¹ç›®ä¸­çš„ä½¿ç”¨çš„æ˜¯cap = cv2.VideoCapture(0)ï¼Œè€Œéæ˜¯cap = cv2.VideoCapture(2)\n",
    "# In this project we use â€œcap = cv2.VideoCapture(0)â€ instead of â€œcap = cv2.VideoCapture(2)â€\n",
    "\n",
    "cap.set(3, 1280) #é•¿ Length\n",
    "cap.set(4, 720) #å®½ Width\n",
    "\n",
    "detector = HandDetector(detectionCon=0.8, maxHands=1)\n",
    "# å› ä¸ºmaxHand=1æ‰€ä»¥å±å¹•ä¸­åªè¯†åˆ«ä¸€åªæ‰‹,å½“maxHand=2åˆ™è¯†åˆ«ä¸¤åªæ‰‹\n",
    "# Since we only need to recognize the fingertip movement of one hand in the screen, we use\"maxHand=1\"\n",
    "\n",
    "class SnakeGameClass:\n",
    "    def __init__(self, pathFood):\n",
    "    #è¯¦ç»†å¯è§è¯¾ä»¶15\n",
    "    # __init__æ˜¯å½“ä½ åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶è°ƒç”¨çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå…¶è¡Œä¸ºç±»ä¼¼äºç±»çš„æ„é€ å‡½æ•°ï¼Œæ¯å½“åˆ›å»ºç±»çš„å¯¹è±¡æ—¶è°ƒç”¨\n",
    "    # __init__ is the first method that is called when you initilaze an object\n",
    "    # self ç”¨äºè®¿é—®å±æ€§æ•°æ®ï¼Œä»£è¡¨ä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œéœ€è¦è®¿é—®ç±»ä¸­çš„ä»»ä½•å˜é‡æˆ–æ–¹æ³•\n",
    "    # self is used to access the attribue data. \n",
    "    # What is \"def __init__ self in Pythonï¼š https://www.educative.io/answers/what-is-def-init-self-in-python\n",
    "\n",
    "        self.points = []\n",
    "        # è›‡çš„é•¿åº¦/èº«ä¸Šæ‰€æœ‰ç‚¹\n",
    "        # All points of the snake\n",
    "        self.lengths = []\n",
    "        # æ¯ä¸€ä¸ªç‚¹ä¹‹é—´çš„è·ç¦» \n",
    "        # Distance between each point\n",
    "        self.currentLength = 0\n",
    "        # è›‡çš„å½“å‰æ€»é•¿åº¦ \n",
    "        # Total length of the snake\n",
    "        self.allowedLength = 150\n",
    "        # è›‡çš„æœ€å¤§å…è®¸é•¿åº¦ä¸º150ï¼Œæ¯å½“ä½ åƒåˆ°é£Ÿç‰©åå®ƒä¼šåŠ é•¿\n",
    "        # Total allowed Length/maximum length\n",
    "        self.previousHead = 0, 0\n",
    "        #ä¸Šä¸€ä¸ªè›‡å¤´çš„ä½ç½®\n",
    "        # Previous head point\n",
    "\n",
    "        # ğŸ‘†è¯¦ç»†è§å›¾ç‰‡1.2\n",
    "        # Details in picture 1.2\n",
    "\n",
    "        self.imgFood = cv2.imread(pathFood, cv2.IMREAD_UNCHANGED)\n",
    "        # cv2.IMREAD_UNCHANGED è¯»å…¥å®Œæ•´å›¾ç‰‡ï¼ŒåŒ…æ‹¬alphaé€šé“ è¯¦ç»†å‚è€ƒï¼šhttps://blog.csdn.net/weixin_43593330/article/details/114685675\n",
    "        # å¯¼å…¥é£Ÿç‰©çš„å›¾ç‰‡, å› ä¸ºæˆ‘ä»¬éœ€è¦å¯¼å…¥çš„å›¾ç‰‡ä¸ºpngä¸”é€æ˜èƒŒæ™¯ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°alphaé€šé“ï¼ŒIMREAD_UNCHANGEDè·å–å¸¦æœ‰alphaé€šé“çš„å›¾åƒ\n",
    "        # Check here: https://docs.opencv.org/3.4/d8/d6a/group__imgcodecs__flags.html\n",
    "        # Import the food image\n",
    "        self.hFood, self.wFood, _ = self.imgFood.shape\n",
    "        # åˆ¤æ–­é£Ÿç‰©çš„é•¿å®½ï¼Œä¸ºé£Ÿç‰©å›¾ç‰‡æœ¬èº«çš„é•¿å®½\n",
    "        # The length and width of the picture are the length and width of the food when you trigger\n",
    "        self.foodPoint = 0, 0\n",
    "        # é£Ÿç‰©çš„åˆå§‹ç”Ÿæˆç‚¹ä¸º0ï¼Œ0\n",
    "        # initial point is 0ï¼Œ0\n",
    "        self.randomFoodLocation()\n",
    "        # è°ƒç”¨ä¸‹é¢çš„def redomFoodLocation(self),éšæœºé£Ÿç‰©çš„åˆå§‹ç”Ÿæˆç‚¹\n",
    "        # redomFoodLocation\n",
    "        self.score = 0\n",
    "        # åˆå§‹åˆ†æ•°ä¸º0\n",
    "        # The initial score is 0\n",
    "        self.gameOver = False\n",
    "        # å¦‚æœæ¸¸æˆç»“æŸä¸ºFalse\n",
    "\n",
    "    def randomFoodLocation(self):\n",
    "    # éšæœºé£Ÿç‰©çš„åˆå§‹ç”Ÿæˆç‚¹\n",
    "    # Coordinate randomization of food\n",
    "        self.foodPoint = random.randint(150, 950), random.randint(150, 600)\n",
    "        #ç”Ÿæˆé£Ÿç‰©çš„èŒƒå›´ å¤ªé è¿‘è¾¹ç¼˜æ— æ³•æ£€æµ‹æ‰‹ï¼\n",
    "        #xçš„èŒƒå›´éšæœºå€¼ä¸º(150, 950)ï¼Œyçš„èŒƒå›´éšæœºå€¼ä¸º(150, 600)\n",
    "        #The random range of x is (150, 950),The random range of y is(150.600)\n",
    "\n",
    "    def update(self, imgMain, currentHead):\n",
    "    # å½“å‰é¢ä½¿ç”¨äº†def __init__ (self, iD=\"\", N=\"\", etc..)ï¼Œæ‰€ä»¥åé¢éœ€è¦ä½¿ç”¨def update\n",
    "    # è¯¦ç»†å¯è§ï¼šhttps://www.cnpython.com/qa/1170573\n",
    "\n",
    "        if self.gameOver:\n",
    "        #å¦‚æœæ¸¸æˆç»“æŸ\n",
    "            cvzone.putTextRect(imgMain, \"Game Over\", [300, 400],\n",
    "                               scale=7, thickness=5, offset=20)\n",
    "            #åˆ©ç”¨cvzone.putTextRectæ¥æ˜¾ç¤ºæ¸¸æˆç»“æŸçš„æç¤ºå­—\n",
    "            cvzone.putTextRect(imgMain, f'Your Score: {self.score}', [300, 550],\n",
    "                               scale=7, thickness=5, offset=20)\n",
    "            #åˆ©ç”¨cvzone.putTextRectæ¥æ˜¾ç¤ºç©å®¶åˆ†æ•°çš„æç¤ºå­—\n",
    "\n",
    "        else:\n",
    "        #å¦åˆ™\n",
    "            px, py = self.previousHead\n",
    "            # å‰ä¸€ä¸ªè›‡å¤´éƒ¨xyå€¼\n",
    "            # PreviousHead coordinates x and y\n",
    "            cx, cy = currentHead\n",
    "            # ç›®å‰çš„è›‡å¤´éƒ¨çš„xyå€¼ï¼Œè¿™é‡Œä¸åŠ selfæ˜¯å› ä¸ºä¸ä»selfä¸­è°ƒç”¨è€Œæ˜¯åœ¨updateä¸­è°ƒç”¨\n",
    "            # CurrentHead coordinates x and y\n",
    "\n",
    "            self.points.append([cx, cy])\n",
    "            # è¿½åŠ ç°æœ‰é•¿åº¦([cx,cy])\n",
    "            # Append is ([cx,cy])\n",
    "            distance = math.hypot(cx - px, cy - py)\n",
    "            # è®¡ç®—è·ç¦»ï¼Œæ ¹å·ä¸‹(cx-px,cy-py)ï¼Œè®¡ç®—æ–œè¾¹ï¼Œå‹¾è‚¡å®šç†\n",
    "            # Get distance between previoushead and currenthead\n",
    "            # math.hypot: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/hypot\n",
    "            self.lengths.append(distance)\n",
    "            # è¿½åŠ è·ç¦»ä¸ºå¢é•¿é•¿åº¦\n",
    "            # Append distance\n",
    "            self.currentLength += distance\n",
    "            # pythonä¸­â€œ+=â€æœ‰ä¸¤ä¸ªæ„æ€ï¼š1ã€ä¸¤ä¸ªå€¼ç›¸åŠ ï¼Œè¿”å›å€¼ç»™ç¬¦å·å·¦ä¾§çš„å˜é‡ï¼Œä¾‹å¦‚ï¼ša+=1ï¼Œæ„æ€å°±æ˜¯a=a+1ã€‚æŠŠå˜é‡aåŠ ä¸Šåè¾¹çš„1ï¼Œå†èµ‹å€¼ç»™a; 2ã€ç”¨äºå­—ç¬¦ä¸²è¿æ¥ï¼Œå˜é‡å€¼å¸¦å¼•å·ï¼Œæ•°æ®ç±»å‹ä¸ºå­—ç¬¦ä¸²ã€‚\n",
    "            # ç›®å‰è›‡çš„é•¿åº¦ = ç›®å‰(ä¹‹å‰)é•¿åº¦ + è¿½åŠ è·ç¦»\n",
    "            # CurrentLength += append distance\n",
    "            self.previousHead = cx, cy\n",
    "            # ä¹‹åä¼šè¿”å› px, py = self.previousHead è¿™ä¸€æ­¥å†æ¬¡å¾ªç¯\n",
    "            # Back to \"px, py = self.previousHead\" step\n",
    "\n",
    "            # é•¿åº¦ç¼©å‡ Length Reduction\n",
    "            if self.currentLength > self.allowedLength:\n",
    "            # å¦‚æœå½“å‰é•¿åº¦å¤§äºå…è®¸çš„æœ€å¤§é•¿åº¦ \n",
    "                for i, length in enumerate(self.lengths):\n",
    "                    self.currentLength -= length\n",
    "                    # pythonä¸­â€œ-=â€çš„æ„æ€ä¸ºï¼š-= æ˜¯å‡æ³•èµ‹å€¼è¿ç®—ç¬¦ã€‚èµ‹å€¼è¿ç®—ç¬¦ä¸»è¦ç”¨äºèµ‹å€¼æ“ä½œï¼Œä¸ºå¯¹è±¡èµ‹å€¼ã€‚å‡æ³•èµ‹å€¼è¿ç®—ç¬¦å¯ä»¥åœ¨è¡¨è¾¾å¼ä¸­ç†è§£ä¸º c -= a ï¼Œç›¸å½“äº c = c - a\n",
    "                    # å‡å°‘é•¿åº¦\n",
    "                    self.lengths.pop(i)\n",
    "                    self.points.pop(i)\n",
    "                    if self.currentLength < self.allowedLength:\n",
    "                    # å¦‚æœå‡å»åç°åœ¨çš„é•¿åº¦å°äºæœ€å¤§å…è®¸é•¿åº¦ï¼Œåˆ™ä¸å†å¾ªç¯æ‰§è¡Œ\n",
    "                        break\n",
    "\n",
    "            # æ£€æŸ¥è›‡æ˜¯å¦åƒåˆ°äº†é£Ÿç‰© Check if snake ate the Food\n",
    "            rx, ry = self.foodPoint\n",
    "            # éœ€è¦è·å–é£Ÿç‰©çš„ä½ç½®\n",
    "            if rx - self.wFood // 2 < cx < rx + self.wFood // 2 and \\\n",
    "                    ry - self.hFood // 2 < cy < ry + self.hFood // 2:\n",
    "            # å¦‚æœ cx åŒæ—¶æ»¡è¶³ åœ¨ rxå‡å»é£Ÿç‰©çš„é•¿åº¦ å’Œ rxåŠ ä¸Šé£Ÿç‰©çš„å®½åº¦é™¤ä»¥2ä¹‹é—´ ä¸” å¦‚æœcyåœ¨ ryå‡å»é£Ÿç‰©é•¿åº¦ å’Œ ryåŠ ä¸Šé£Ÿç‰©çš„å®½åº¦é™¤ä»¥2ä¹‹é—´\n",
    "                self.randomFoodLocation()\n",
    "                # è›‡åƒäº†é£Ÿç‰©å é£Ÿç‰©éšæœºç”Ÿæˆåœ¨æ–°åæ ‡\n",
    "                # Food is randomly generated after being eaten by the snake\n",
    "                self.allowedLength += 50\n",
    "                # å…è®¸å¢åŠ çš„é•¿åº¦ æ¯åƒä¸€ä¸ª+50\n",
    "                # +50 length when the snake eats the food\n",
    "                self.score += 1\n",
    "                # è®¡åˆ† æ¯åƒä¸€ä¸ª+1åˆ†\n",
    "                # When the snake eats the food, you get one point score\n",
    "                print(self.score)\n",
    "                # è¾“å‡ºåˆ†æ•°\n",
    "                # show your score\n",
    "\n",
    "            # ç”»è›‡ Draw Snake\n",
    "            if self.points:\n",
    "                for i, point in enumerate(self.points):\n",
    "                # enumerateçš„ç”¨æ³•ï¼šhttps://blog.csdn.net/fanfangyu/article/details/124595937\n",
    "                    if i != 0:\n",
    "                    #å¦‚æœiä¸ç­‰äº0\n",
    "                        cv2.line(imgMain, self.points[i - 1], self.points[i], (0, 69, 255), 20)\n",
    "                        #è¿™é‡Œçš„é¢œè‰²æ˜¯BGR\n",
    "                        #cv2.lineç”»çº¿(imgMainä¸ºæ˜¾ç¤ºåœ¨ä¸»è§†å›¾ä¸Š,self.points[i,-1]ä¸ºç¬¬ä¸€ä¸ªç‚¹,self.points[i]ä¸ºç¬¬äºŒä¸ªç‚¹,(187, 209, 201)ä¸ºé¢œè‰²,20ä¸ºåšåº¦)\n",
    "                        #cv2.line(image, start_point, end_point, color, thickness) \n",
    "                        #selfpoints[i - 1], self.points[i]ä¸ºæˆ‘ä»¬æƒ³è¦ç”»çº¿çš„ä¸¤ä¸ªç«¯ç‚¹\n",
    "                        # é¢œè‰² #BBD1C9 çš„ RGB å€¼ä¸º(187,209,201) /å¼ƒç”¨\n",
    "                        # é¢œè‰² #FF4500 çš„ RGB å€¼ä¸º(255,69,0)\n",
    "                cv2.circle(imgMain, self.points[-1], 20, (0,255,223), cv2.FILLED)\n",
    "                #è¿™é‡Œçš„é¢œè‰²æ˜¯BGR\n",
    "                #cv2.circle(img,pointIndex,20,(123,166,150),cv2.FILLED)ï¼Œself.points[-1]ä¸ºæœ€åä¸€ä¸ªç‚¹\n",
    "                # cv2.circleä¸ºç”»åœ†å½¢(imgï¼ŒpointIndexä¸ºåœ†å¿ƒ,20ä¸ºåŠå¾„,(123,166.150)ä¸ºRGB,cv2.FILLEDä¸ºå¡«å……)ï¼Œé£ŸæŒ‡ä½ç½®å¤„ç”»åœ†ï¼Œä¹Ÿå°±æ˜¯è›‡å¤´å¤„\n",
    "                # Syntax: cv2.circle(image, center_coordinates, radius, color, thickness)\n",
    "                # cv2.circle: https://www.geeksforgeeks.org/python-opencv-cv2-circle-method/\n",
    "                # é¢œè‰² #7BA696 çš„ RGB å€¼ä¸º(123,166,150) /å¼ƒç”¨\n",
    "                # é¢œè‰² #DFFF00 çš„ RGB å€¼ä¸º(223,255,0)\n",
    "\n",
    "            # ç”»é£Ÿç‰© Draw Food\n",
    "            imgMain = cvzone.overlayPNG(imgMain, self.imgFood,\n",
    "                                       (rx - self.wFood // 2, ry - self.hFood // 2))\n",
    "            # å¦‚æœä½¿ç”¨imgMain = cvzone.overlayPNG(imgMain, self.imgFood,(rx,ry))çš„è¯ï¼Œé£Ÿç‰©å›¾ç‰‡æ˜¯åœ¨è§’è½è€Œä¸æ˜¯åœ¨ä¸­å¿ƒï¼Œè€Œä¸Šé¢ä½¿ç”¨çš„rx - self.wFood // 2, ry - self.hFood // 2ä¹Ÿå°±æ˜¯é•¿å®½é™¤ä»¥2\n",
    "            # ä½¿ç”¨cvzoneå¯¼å…¥é£Ÿç‰©å›¾åƒ(imgMainä¸ºèƒŒæ™¯å›¾åƒï¼Œself.imgFoodä¸ºå‰é¢çš„å›¾åƒ)\n",
    "\n",
    "            cvzone.putTextRect(imgMain, f'Score: {self.score}', [50, 80],\n",
    "                               scale=3, thickness=3, offset=10)\n",
    "            # cv2.putText(imgMain, f'Score: {self.score}', (50,80), FONT_HERSHEY_SIMPLEX, 3, (0,255,0), 5)\n",
    "            # cv2.putTextç»˜åˆ¶æ–‡æœ¬å›¾åƒ(imgMainä¸ºå›¾ç‰‡ï¼Œf'Scoreï¼š{self.scoreå¾—åˆ†}ä¸ºæ·»åŠ çš„æ–‡å­—ï¼Œ[50,80]ä¸ºå·¦ä¸Šè§’åæ ‡ï¼Œå­—ä½“ï¼Œå­—ä½“å¤§å°ï¼Œé¢œè‰²ï¼Œå­—ä½“ç²—ç»†\n",
    "            # cvzone.putTextRect(imgMain, f'Score: {self.score}', [50, 80],scale=3, thickness=3, offset=10)\n",
    "            # cv2.putText(image, text, org, font, fontScale, color[, thickness[, lineType[, bottomLeftOrigin]]])\n",
    "\n",
    "            # æ£€éªŒç¢°æ’ Check for Collision\n",
    "            # éœ€è¦æŠŠæ­¤éƒ¨åˆ†ç½®æ”¾äºç”»é£Ÿç‰©å’Œç”»è›‡ä¹‹å\n",
    "            pts = np.array(self.points[:-2], np.int32)\n",
    "            # points[:-2] ä¸å–æœ€åä¸¤ç‚¹\n",
    "            pts = pts.reshape((-1, 1, 2))\n",
    "            cv2.polylines(imgMain, [pts], False, (0, 255, 0), 3)\n",
    "            # ä¸å…³é—­æ‰€ä»¥æ˜¯False\n",
    "            minDist = cv2.pointPolygonTest(pts, (cx, cy), True)\n",
    "            # æ£€éªŒå½“å‰çš„xyæ˜¯å¦å‡»ä¸­äº†è¿™äº›ç‚¹ä¸­çš„ä»»æ„ä¸€ç‚¹ï¼Œå¦‚æœä¸ºTrueï¼Œåˆ™æˆ–åœ¨åé¢è¾“å‡ºYummy\n",
    "\n",
    "            if -1 <= minDist <= 1:\n",
    "                print(\"Yummy\")\n",
    "                #å¦‚æœå‘½ä¸­ï¼Œåˆ™è¾“å‡ºYummy\n",
    "                self.gameOver = True\n",
    "                #å¦‚æœæ¸¸æˆç»“æŸä¸ºTrue\n",
    "                #åˆ™æ‰§è¡Œé‡æ–°å¼€å§‹ï¼Œä¸å¼€å§‹éƒ¨åˆ†å†…å®¹ç›¸åŒ\n",
    "                self.points = []  # all points of the snake\n",
    "                self.lengths = []  # distance between each point\n",
    "                self.currentLength = 0  # total length of the snake\n",
    "                self.allowedLength = 150  # total allowed Length\n",
    "                self.previousHead = 0, 0  # previous head point\n",
    "                self.randomFoodLocation()  # redom food location\n",
    "\n",
    "        return imgMain\n",
    "        # è¿”å›ç”»é£Ÿç‰©\n",
    "\n",
    "game = SnakeGameClass(\"C:/Users/78089/anaconda3/pics/Star.png\")\n",
    "#é£Ÿç‰©å›¾ç‰‡çš„è·¯å¾„ï¼Œæ³¨æ„æ˜¯ç”¨\"/\"è€Œä¸æ˜¯\"\\\"\n",
    "#food Image path\n",
    "\n",
    "while True:\n",
    "    success,img = cap.read()\n",
    "    # è¯»å– ä½œç”¨æ˜¯æä¾›æ¡†æ¶\n",
    "    img = cv2.flip(img,1) \n",
    "    # æ°´å¹³åè½¬å›¾ç‰‡ ä¸ç°å®ä¸­çš„æ‰‹çš„å˜åŒ–ä¿æŒä¸€è‡´ æ›´åˆ©äºæ“ä½œ\n",
    "    # Flip the hand img to play the game without mirroring\n",
    "    hands,img = detector.findHands(img,flipType=False)\n",
    "    # å› ä¸ºå‰ä¸€æ­¥éª¤çš„æ‰‹éƒ¨å·¦å³ä¼šè¯†åˆ«é”™è¯¯ï¼ˆå·¦æ‰‹è¯†åˆ«ä¸ºå³æ‰‹ï¼Œå³æ‰‹è¯†åˆ«ä¸ºå·¦æ‰‹ï¼‰ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œä½¿ç”¨flipType=Falseè¿›è¡Œè°ƒæ•´\n",
    "    # Because flip was used in the previous step, it will lead to wrong recognition of left and right hands (left hand is recognized as right hand), so use flipType=False here to fix it\n",
    "\n",
    "    if hands:\n",
    "        lmList = hands[0]['lmList']\n",
    "        # lmList: å…·æœ‰é€šç”¨æ¨¡å‹çš„ Im å¯¹è±¡åˆ—è¡¨, List of Im Objects with a Common Model\n",
    "        # lmList: https://rdrr.io/cran/nlme/man/lmList.html\n",
    "        # hands[0]ä¸ºç¬¬ä¸€åªæ‰‹\n",
    "        pointIndex = lmList[8][0:2]\n",
    "        # lmList[8]ï¼Œä¸ºä»€ä¹ˆæ˜¯æ•°å­—8ï¼Œå¯è§äº: ä¸Šé¢å›¾è¡¨1.1 \n",
    "        # About lmList[8], you can check picture 1.1\n",
    "        # Hand recognition: https://medium.com/geekculture/computer-vision-using-mediapipe-c0933b743cf5\n",
    "        # æˆ‘ä»¬ä¸éœ€è¦å¤„ç†3Dï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦xyä¸¤ä¸ªåæ ‡ï¼Œæ‰€ä»¥åªå–ä¸¤ä¸ªå€¼[0:2]ï¼Œ2ä¸åŒ…å«åœ¨å…¶ä¸­ï¼Œ[0:2]ä¸­åªåŒ…å«0å’Œ1\n",
    "        img = game.update(img, pointIndex)\n",
    "        #\n",
    "    cv2.imshow(\"Image\",img)\n",
    "    #cv2.imshow(\"Image\",img)å‡½æ•°å¯ä»¥åœ¨çª—å£ä¸­æ˜¾ç¤ºå›¾åƒ\n",
    "    key = cv2.waitKey(1) \n",
    "    #cv2.waitKey(1) == ord('Key') åŠŸèƒ½ï¼šç­‰å¾…é”®ç›˜ï¼‡keyï¼‡é”®çš„è¾“å…¥å‚æ•°ï¼š1:è¡¨ç¤ºå»¶æ—¶1msåˆ‡æ¢åˆ°ä¸‹ä¸€å¸§å›¾åƒ\n",
    "\n",
    "    if key == ord('r'):\n",
    "    # å¦‚æœæŒ‰ä¸‹\"r\",é‡æ–°å¼€å§‹æ¸¸æˆ\n",
    "    # Press\"r\" to reset the game\n",
    "        game.gameOver = False\n",
    "        # é‡ç½®æ¸¸æˆ\n",
    "        # Reset game\n",
    "        \n",
    "    if cv2.waitKey(10) & 0xFF == ord('q'):\n",
    "    # æŒ‰ä¸‹\"q\"å…³é—­çª—å£\n",
    "    # Press\"q\" to close the window\n",
    "        break\n",
    "cap.release()\n",
    "cv2.destroyAllWindows()\n",
    "#åœæ­¢æ•è·è§†é¢‘å’Œå…³é—­ç›¸åº”çš„æ˜¾ç¤ºçª—å£"
   ]
  },
  {
   "cell_type": "raw",
   "id": "eb69a1b3",
   "metadata": {},
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.15"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
